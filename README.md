# Dairycs – STM32 Embedded Application

This project implements a modular embedded system for the STM32F401RE microcontroller, developed using STM32CubeIDE and HAL drivers. It demonstrates real-time ADC sampling, UART-based command control, and state machine management with a focus on clarity, maintainability, and hardware abstraction.

## Project Structure

The application code resides under the `SW/` directory:

```
SW/
├── Inc/        # Header files
├── Src/        # Source files
```

The project also includes:

- `Core/`: Auto-generated by STM32CubeMX
- `Drivers/`: CMSIS and HAL libraries
- `Dairycs.ioc`: CubeMX configuration
- Linker scripts for Flash and RAM builds

## Main Features

- Timed ADC sampling using DMA and dual timers (TIM10/TIM11)
- UART command parsing using ReceiveToIdle DMA
- Simple finite state machine for system control
- GPIO interrupt and button debounce handling
- Structured and readable code following MaJerle's C coding standards

## System Behavior

- On power-up, the system enters `SYS_STATE_IDLE`.
- A button press or UART "start" message triggers ADC logging (`SYS_STATE_RUNNING`).
- Timer-based logging periodically prints ADC readings over UART.
- A "stop" message or second button press halts ADC logging and returns to idle.
- All errors are routed to `SYS_STATE_ERROR` and logged.

## Getting Started

1. Open the project in STM32CubeIDE.
2. Ensure the target board is STM32F401RE (e.g., Nucleo-F401RE).
3. Connect via ST-Link and build/flash the project.
4. Open a UART terminal (e.g., 115200 baud) on `USART2`.
5. Send `"start"` or `"stop"` to control logging behavior.

## File Highlights

- `System.c/h`: Main application logic and state handling
- `main.c`: Initialization and entry point
- `Dairycs.ioc`: Peripheral configuration
- `STM32F401RETX_FLASH.ld`: Linker script for production
- `STM32F401RETX_RAM.ld`: Optional RAM execution for development

## Notes

- UART communication uses interrupt-based reception with idle line detection.
- ADC data is logged using a statically allocated buffer and printed via `printf`.
- GPIO interrupts are debounced in software with a fixed delay.
- The project is designed for expandability—new system states or message handlers can be added with minimal refactoring.

## License

TBD
